@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="page-wrapper">
    <!-- Bread crumb and right sidebar toggle -->
    <div class="page-breadcrumb">
        <div class="row align-items-center">
            <div class="col-5">
                <h4 class="page-title">Dashboard</h4>
                <div class="d-flex align-items-center">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                        </ol>
                    </nav>
                </div>
            </div>
            
        </div>
    </div>
    <!-- End Bread crumb and right sidebar toggle -->
    <!-- Container fluid  -->
    <div class="container-fluid">
        <!-- Table -->
   
        <div class="row">
            <!-- column -->
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <!-- title -->
                        <div class="d-md-flex align-items-center">
                            <div>
                                <h4 class="card-title">All Requests</h4>
                                <h5 class="card-subtitle">Overview of requests</h5>
                            </div>
                            <div class="ml-auto">
                                <div class="dl">
                                    <select class="filter">
                                        <option value="0" selected>None</option>
                                        <option value="1">Time</option>
                                        <option value="2">Priority</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- title -->
                    </div>
                    <div class="table-responsive">
                        <table class="table v-middle">
                            <thead>
                                 <tr class="bg-light">
                                     <th class="border-top-0">Id</th>
                                     <th class="border-top-0">Title</th>
                                     <th class="border-top-0">Description</th>
                                     <th class="border-top-0">Date sent</th>
                                     <th class="border-top-0">Priority</th>
                                     <th class="border-top-0">Employee Sent Request</th>
                                     <th class="border-top-0">Employee Handles Request</th>
                                     <th class="border-top-0">Action</th>
                                 </tr>
                            </thead>
                            <tbody>
                                @foreach (var req in ViewBag.requests)
                                {
                                    <tr>
                                        <td>
                                            @req.Mayeucau
                                        </td>
                                        <td>
                                            @req.Tieude
                                        </td>
                                        <td>
                                            @req.Noidung
                                        </td>
                                        <td>
                                            @req.Ngaygui
                                        </td>
                                        <td>
                                            @if (@req.Madouutien == 1)
                                            {
                                                <span>Low</span>
                                            }
                                            else if (@req.Madouutien == 2)
                                            {
                                                <span>Medium</span>
                                            }
                                            else if (@req.Madouutien == 3)
                                            {
                                                <span>High</span>
                                            }
                                        </td>
                                        <td>
                                            @req.ManvGui
                                        </td>
                                        <td>
                                            @req.ManvXuly
                                        </td>
                                        <td>
                                            <a asp-area="admin" asp-controller="requestadmin" asp-action="details" asp-route-id="@req.Mayeucau" style="padding-right: 10px;">
                                                <i class="fa fa-eye"></i>
                                            </a>
                                            <a href="javascript:void(0)">
                                                <i class="ti-check"></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>
   
        <!-- Table -->
    </div>
    
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Function to sort based on priority
        function sortTableByPriority(order) {
            var rows = $('.table tbody > tr').get();
            var priorityOrder = { 'Low': 3, 'Medium': 2, 'High': 1 };
            rows.sort(function (a, b) {
                var priorityA = priorityOrder[$(a).find('td').eq(4).text().trim()];
                var priorityB = priorityOrder[$(b).find('td').eq(4).text().trim()];
                return (order === 'asc') ? priorityA - priorityB : priorityB - priorityA;
            });
            $.each(rows, function (index, row) {
                $('.table tbody').append(row);
            });
        }

        // Sort table based on filter selection
        $('.filter').on('change', function () {
            var value = $(this).val();
            if (value === "1") {
                // Sort by Date
                var rows = $('.table tbody > tr').get();
                rows.sort(function (a, b) {
                    var dateA = new Date($(a).find('td').eq(3).text());
                    var dateB = new Date($(b).find('td').eq(3).text());
                    return dateB - dateA;
                });
                $.each(rows, function (index, row) {
                    $('.table tbody').append(row);
                });
            } else if (value === "2") {

                sortTableByPriority('asc');
            }
        });
    });
</script>

